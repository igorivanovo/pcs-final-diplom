# Дипломная работа. Поисковая система
![netology logo](https://upload.wikimedia.org/wikipedia/commons/thumb/0/0a/Netology_logo.png/320px-Netology_logo.png)


[официальный сайт](https://netology.ru/)

Наша цель - разработать класс поискового движка, который способен быстро находить указанное слово(или группу слов через " ") по страницам pdf-файлов суммарное количество раз, которое встретилось любое из слов запроса., причём ранжируются результаты по количеству вхождений. Также у нас есть сервер, который обслуживает входящие запросы с помощью этого движка.


В проекте есть:

| Класс      | Описание                                                                                                                                                                                                                 |
| ----------- |--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `Main`      | Запуск сервера, обслуживающего поисковые запросы                                                                                                                                                                         |
| `PageEntry`   | Класс, описывающий один элемент результата одного поиска. Он состоит из имени пдф-файла, номера страницы и количества раз, которое встретилось это слово на ней                                                          |
| `SearchEngine`   | Интерфейс, описывающий поисковый движок.  На запрос из слова отвечает списком элементов результата ответа                                                                                                                |
| `BooleanSearchEngine`   | Реализация поискового движка. Слово `Boolean` пришло из теории информационного поиска, т.к. наш движок ищет в тексте ровно то слово, которое было указано, без использования синонимов и прочих приёмов нечёткого поиска |

## PDF
Для работы с пдф мы используем библиотеку `com.itextpdf:itext7-core:7.1.15`:
```xml
        <dependency>
            <groupId>com.itextpdf</groupId>
            <artifactId>itext7-core</artifactId>
            <version>7.1.15</version>
            <type>pom</type>
        </dependency>
```

Основные инструменты из этой библиотеки :

* Чтобы создать объект пдф-документа, нужно указать объект `File` этого документа следующим классам: `var doc = new PdfDocument(new PdfReader(pdf));`.
* Чтобы получить объект одной страницы документа, нужно вызвать `doc.getPage(номерСтраницы)`.  метод `doc.getNumberOfPages()`  узнать количество * страниц в документе.
* Чтобы получить текст со страницы, используем `var text = PdfTextExtractor.getTextFromPage(page);`.
* Чтобы разбить текст на слова (а они в этих документах разделены могут быть не только пробелами), используем `var words = text.split("\\P{IsAlphabetic}+");`.

## Индексация и поиск
 реализации класса `BooleanSearchEngine`. Мы хотим чтобы поиск (метод `search`) работал быстро, поэтому предпочтём сканирование всех пдф-ок в конструкторе класса с сохранением информации для каждого слова из pdf-файлов. Тогда метод `search` сможет отрабатывать быстро, по сути возвращать уже посчитанный в конструкторе для слова готовый список-ответ. Т.е. в конструкторе для каждого слова сохраняем готовый на возможный будущий запрос ответ в виде `List<PageEntry>` (для этого  используем мапу, где ключом будет слово, а значением - искомый список). Такое предварительное сканирование файлов по которым мы будем искать называется _индексацией_.

В итоге,мы реализуем логику индексации в конструкторе. Сканируя каждый пдф-файл мы перебираем его страницы, для каждой страницы извлекаем из неё слова и подсчитываете их количество. После подсчёта, для каждого уникального слова пдф-файла создаём объект `PageEntry` и сохраняем в мапу в поле. Мы хотим регистронезависимый поиск, т.е. по слову "бизнес" учитывается и "бизнес", и "Бизнес" в документах (для этого при обработке достаточно каждое слово приводим в нижний регистр с помощью встроенного метода класса `String` для этих целей).

Для подсчёта частоты слов используем следующий приём :
```java
Map<String, Integer> freqs = new HashMap<>(); // мапа, где ключом будет слово, а значением - частота
for (var word : words) { // перебираем слова
    if (word.isEmpty()) {
        continue;
    }
    word = word.toLowerCase();
    freqs.put(word, freqs.getOrDefault(word, 0) + 1);
}
```

Также, списки ответов для каждого слова  отсортированы в порядке уменьшения поля `count`. Для этого класс `PageEntry`  реализует интерфейс `Comparable`.
 Вот пример работы на слове "старт":
```
[PageEntry{pdf=SoftSkills.pdf, page=3, count1}, PageEntry{pdf=Технология распознования лиц.pdf, page=6, count1}]
```
на слове "арт":
```
[PageEntry{pdf=Продвижение игр.pdf, page=1, count1}]
```
на слове "нолан":
```
[PageEntry{pdf=Продвижение игр.pdf, page=1, count1}]      
```
на слове "игра":
```
[PageEntry{pdf=Продвижение игр.pdf, page=1, count1}, PageEntry{pdf=Продвижение игр.pdf, page=2, count1}, PageEntry{pdf=Продвижение игр.pdf, page=7, count1}]
```
## Сервер
 В `main`  запускается сервер, слушающий порт `8989`, к которому приходят подключения и на входной поток подавать одно слово (обозначим как `word`) или группа слов, отвечает результатом вызова метода `search(word)`, но в виде JSON-текста (библиотека для работы с JSON подключена к `pom.xml`).
```xml    

        <dependency>
            <groupId>com.google.code.gson</groupId>
            <artifactId>gson</artifactId>
            <version>2.10.1</version>
        </dependency>

```


Пример ответа на запрос "старт":
```json
[
 {
  "pdfName": "SoftSkills.pdf",
  "page": 3,
  "count": 1
 },
 {
  "pdfName": "Технология распознования лиц.pdf",
  "page": 6,
  "count": 1
 }
]

```
Пример ответа на запрос "нолан игра арт в снег старт":
```json
[
 {
  "pdfName": "Продвижение игр.pdf",
  "page": 1,
  "count": 3
 },
 {
  "pdfName": "Продвижение игр.pdf",
  "page": 2,
  "count": 1
 },
 {
  "pdfName": "Продвижение игр.pdf",
  "page": 7,
  "count": 1
 },
 {
  "pdfName": "SoftSkills.pdf",
  "page": 3,
  "count": 1
 },
 {
  "pdfName": "Технология распознования лиц.pdf",
  "page": 6,
  "count": 1
 }
]



```
 


